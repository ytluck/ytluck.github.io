<!DOCTYPE html>
<html lang="zh_cn">
<head>
        <meta charset="utf-8" />
        <title>Scrapy中的选择器</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">ytluck—For you </a></h1>
                <nav><ul>
                    <li><a href="http://ytluck.github.io/">Home</a></li>
                    <li><a href="/About me.html">About Me</a></li>
                    <li><a href="/big-data/index.html">Big Data</a></li>
                    <li><a href="/data-mining/index.html">Data Mining</a></li>
                    <li class="active"><a href="/items/index.html">Items</a></li>
                    <li><a href="/os/index.html">OS</a></li>
                    <li><a href="/program/index.html">Program</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/items/my-item-post-11.html" rel="bookmark"
           title="Permalink to Scrapy中的选择器">Scrapy中的选择器</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-03-05T20:10:00+08:00">
                Published: 2017-03-05 20:10:00
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/ytwan.html">ytwan</a>
        </address>
<p>In <a href="/items/index.html">Items</a>.</p>
<p>tags: <a href="/tag/web.html">Web</a> </p>
</footer><!-- /.post-info -->      <h3>bs4</h3>
<div class="highlight"><pre><span></span><span class="err">步骤</span>
  <span class="c1">##01.第一步：导入 bs4 库     </span>
    <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
  <span class="c1">##02.第二步 创建 beautifulsoup 对象</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">))</span><span class="c1">#缺省默认的解析器&quot;html.parser&quot;</span>
    <span class="n">soup</span><span class="o">=</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s2">&quot;&lt;a&gt;&lt;/p&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;lxml&quot;</span><span class="p">)</span>
    <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="s2">&quot;xml&quot;</span><span class="p">)</span>
    <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span>  <span class="s2">&quot;lxml-xml&quot;</span><span class="p">)</span>
    <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s2">&quot;&lt;a&gt;&lt;/p&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;html5lib&quot;</span><span class="p">)</span>
    <span class="n">soup</span><span class="o">=</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">respone</span><span class="o">.</span><span class="n">body</span><span class="p">,</span><span class="s2">&quot;html5lib&quot;</span><span class="p">,</span><span class="n">from_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1">##缺省默认utf-8</span>
    <span class="n">soup</span><span class="o">=</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">respone</span><span class="o">.</span><span class="n">body</span><span class="p">,</span><span class="s2">&quot;html5lib&quot;</span><span class="p">,</span><span class="n">from_encoding</span><span class="o">=</span><span class="s1">&#39;gb2312&#39;</span><span class="p">)</span>
  <span class="c1">##03.第三步-各种操作</span>
    <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span> <span class="n">name</span> <span class="p">,</span> <span class="n">attrs</span> <span class="p">,</span> <span class="n">recursive</span> <span class="p">,</span> <span class="n">text</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
    <span class="c1">##find_all() 方法搜索当前tag的所有tag子节点,并判断是否符合过滤器的条件</span>
    <span class="c1">##CSS选择器</span>
    <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="err">，返回类型是</span> <span class="nb">list</span>
<span class="err">说明</span>
    <span class="c1">##Beautiful Soup将复杂HTML文档转换成一个复杂的树形结构,每个节点都是Python对象,</span>
    <span class="c1">##所有对象可以归纳为4种:</span>
    <span class="c1">##Tag</span>
    <span class="n">soup</span><span class="err">加标签名轻松地获取这些标签的内容</span>
    <span class="n">Tag</span><span class="err">，它有两个重要的属性，是</span> <span class="n">name</span> <span class="err">和</span> <span class="n">attrs</span>
    <span class="n">tag</span> <span class="err">的</span> <span class="o">.</span><span class="n">content</span> <span class="err">属性可以将</span><span class="n">tag</span><span class="err">的子节点以列表的方式输</span>
    <span class="k">print</span> <span class="n">soup</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">##NavigableString                </span>
    <span class="c1">##BeautifulSoup</span>
    <span class="c1">##Comment</span>
</pre></div>


<h3>lxml 依托于ElementTree的选择器(seletors)</h3>
<div class="highlight"><pre><span></span><span class="err">步骤</span>
  <span class="mf">01.</span><span class="err">引入</span>
    <span class="kn">from</span> <span class="nn">scrapy.selector</span> <span class="kn">import</span> <span class="n">Selector</span>
    <span class="kn">from</span> <span class="nn">scrapy.http</span> <span class="kn">import</span> <span class="n">HtmlResponse</span>
  <span class="mf">02.</span><span class="err">以</span> <span class="n">response</span> <span class="err">构造选择器</span><span class="o">--</span><span class="err">还可以以文字</span><span class="o">--</span><span class="err">在这里暂且不涉及</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HtmlResponse</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    <span class="n">sl</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
  <span class="mf">03.</span><span class="err">各种操作</span>
    <span class="n">sl</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//span/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
<span class="err">说明</span>
    <span class="n">XPath</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">language</span> <span class="k">for</span> <span class="n">selecting</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">HTML</span> <span class="ow">or</span> <span class="n">XML</span> <span class="n">document</span>
    <span class="n">CSS</span>   <span class="ow">is</span> <span class="n">a</span> <span class="n">language</span> <span class="k">for</span> <span class="n">applying</span> <span class="n">styles</span> <span class="n">to</span> <span class="n">HTML</span> <span class="n">documents</span>
    <span class="n">Regular</span> <span class="n">expressions</span>
       <span class="err">方法返回类</span> <span class="n">SelectorList</span> <span class="err">的实例的列表</span>
        <span class="o">.</span><span class="n">xpath</span><span class="p">()</span> 
            <span class="o">.</span><span class="n">extract</span><span class="p">()</span><span class="err">方法</span>
            <span class="o">.</span><span class="n">extract_first</span><span class="p">()</span>
        <span class="o">.</span><span class="n">css</span><span class="p">()</span>
            <span class="o">.</span><span class="n">extract</span><span class="p">()</span><span class="err">方法</span>
            <span class="o">.</span><span class="n">extract_first</span><span class="p">()</span>
        <span class="o">.</span><span class="n">re</span><span class="p">()</span>
            <span class="o">.</span><span class="n">re_first</span><span class="p">()</span>     
     <span class="n">Xpath</span> <span class="err">语法，使用路径表达式在</span> <span class="n">XML</span> <span class="err">文档中进行导航，</span>
     <span class="err">在</span> <span class="n">XPath</span> <span class="err">中，有七种类型的节点：元素、属性、文本、命名空间、处理指令、注释以及文档（根）节点</span>  
      <span class="mf">01.</span> <span class="err">路径表达式</span>
        <span class="n">nodename</span>    <span class="err">选取此节点的所有子节点。</span>
        <span class="o">/</span>           <span class="err">从根节点选取。</span>
        <span class="o">//</span>          <span class="err">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</span>
        <span class="o">.</span>           <span class="err">选取当前节点。</span>
        <span class="o">..</span>          <span class="err">选取当前节点的父节点。</span>
        <span class="err">@</span>           <span class="err">选取属性。</span>
      <span class="mf">02.</span><span class="n">Predicates</span><span class="o">--</span><span class="err">谓语用来查找某个特定的节点或者包含某个指定的值的节点。谓语被嵌在方括号中</span>
            <span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">last</span><span class="p">()]</span>
</pre></div>


<h3>参考：</h3>
<div class="highlight"><pre><span></span>Beautiful Soup 4.2.0 文档       https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/
lxml - XML and HTML with Python http://lxml.de/index.html 
Selectors                       https://doc.scrapy.org/en/latest/topics/selectors.html#
</pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="https://github.com/ytluck">yt</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://pelican-zh.readthedocs.org/en/latest/zh-cn/settings/">ye</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-76643035-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>